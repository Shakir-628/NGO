@model IEnumerable<NGO_Project.RequestedItem>


@{
    Layout = "~/Views/Shared/_LayoutNGO.cshtml";
}

<!-- Tab Contents -->
<div class="tab-content">
    <!-- Dashboard Cards -->
    <div class="dashboard-cards">
        <div class="dashboard-card">
            <div class="card-title">Active Requests <span class="card-icon">&#9432;</span></div>
            <div class="card-value">12</div>
            <div class="card-sub">+2 from last week</div>
        </div>
        <div class="dashboard-card">
            <div class="card-title">Inventory Items <span class="card-icon">&#9432;</span></div>
            <div class="card-value">247</div>
            <div class="card-sub">85% in stock</div>
        </div>
        <div class="dashboard-card">
            <div class="card-title">Active Donors <span class="card-icon">&#128101;</span></div>
            <div class="card-value">156</div>
            <div class="card-sub">+12 this month</div>
        </div>
        <div class="dashboard-card refused">
            <div class="card-title">Refused Requests <span class="card-icon">&#9888;</span></div>
            <div class="card-value">3</div>
            <div class="card-sub">Need attention</div>
        </div>
    </div>
    <!-- Frequently Refused Requests -->
    <div class="refused-requests-box">
        <div class="refused-title">&#9888; Frequently Refused Requests</div>
        <div class="refused-desc">Items refused 5+ times – consider posting to public feed</div>
        <div class="refused-list">

            @if (!Model.Any())
            {
                <div style="color: #6b7280; text-align: center; padding: 20px;">No active aid requests found. Post a new request to get started!</div>
            }
            else
            {
                foreach (var item in Model)
                {
                    <div class="refused-item">
                        <div>
                            <div class="refused-item-title">@Html.DisplayFor(modelItem => item.ItemName)</div>
                            <div class="refused-item-desc">Refused 7 times in last month</div>
                        </div>
                        <button class="post-btn" data-id="@item.RequestId">Post to Feed</button>
                    </div>
                }
            }


        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).on("click", ".post-btn", function () {
    var id = $(this).data("id");
    if (!confirm("Mark this request as posted?")) return;

    $.ajax({
        url: '@Url.Action("UpdateIsPosted", "RequestedItems")',
        type: "POST",
        data: { id: id },
        success: function (response) {
            if (response.success) {
                alert(response.message);
                // Optional: visually update the button or row
                location.reload(); // or dynamically update UI instead of reload
            } else {
                alert("Error: " + response.message);
            }
        },
        error: function () {
            alert("Something went wrong. Try again.");
        }
    });
});
</script>
